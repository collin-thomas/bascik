<!DOCTYPE html>

<script id="scoped-script">
  let i = 0;
  new MutationObserver((rx) =>
    rx.forEach(({ target: s }) => {
      if (s.tagName !== "SCRIPT" || s.scoped || !s.hasAttribute("scoped"))
        return;
      s.scoped = true;
      if (!s.id) s.id = "__s" + i++;
      s.innerHTML = `(function(){${s.innerHTML}}).call(document.getElementById('${s.id}').parentNode)`;
    })
  ).observe(document, {
    childList: true,
    subtree: true,
    attributes: true,
    attributeFilter: ["scoped"],
  });
</script>

<main>
  <p>Hello world</p>
  <p id="title">Welcome to the scoped script tags</p>
  <script scoped>
    console.log(this);
  </script>
</main>
